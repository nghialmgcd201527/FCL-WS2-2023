<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.114.1">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="../../images/favicon.png" type="image/png">

    <title>Adding the missing code :: AWS System Manager</title>

    
    <link href="../../css/nucleus.css?1692263736" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1692263736" rel="stylesheet">
    <link href="../../css/hybrid.css?1692263736" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1692263736" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1692263736" rel="stylesheet">
    <link href="../../css/auto-complete.css?1692263736" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1692263736" rel="stylesheet">
    <link href="../../css/theme.css?1692263736" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1692263736" rel="stylesheet">
    
    <link href="../../css/theme-workshop.css?1692263736" rel="stylesheet">
    
    

    <script src="../../js/jquery-3.3.1.min.js?1692263736"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="../../4-saas/4.2-misscode/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="../../">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1692263736"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1692263736"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="../../js/search.js?1692263736"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-introduce/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="../../1-introduce/">
           <b> 1. </b> Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/1-introduce/1.1-whatsaas/" title="What is unique about SaaS-based delivery model?" class="dd-item 
        
        
        
        ">
      <a href="../../1-introduce/1.1-whatsaas/">
           <b> 1.1 </b> What is unique about SaaS-based delivery model?
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-introduce/1.2-whyserverless/" title="Why Serverless?" class="dd-item 
        
        
        
        ">
      <a href="../../1-introduce/1.2-whyserverless/">
           <b> 1.2 </b> Why Serverless?
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-introduce/1.3-whatbuild/" title="What you will build?" class="dd-item 
        
        
        
        ">
      <a href="../../1-introduce/1.3-whatbuild/">
           <b> 1.3 </b> What you will build?
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-introduce/1.4-serverlessused/" title="AWS Serverless services used" class="dd-item 
        
        
        
        ">
      <a href="../../1-introduce/1.4-serverlessused/">
           <b> 1.4 </b> AWS Serverless services used
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-introduce/1.5-prior/" title="Prior knowledge" class="dd-item 
        
        
        
        ">
      <a href="../../1-introduce/1.5-prior/">
           <b> 1.5 </b> Prior knowledge
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-prerequiste/" title="Preparation " class="dd-item 
        
        
        
        ">
      <a href="../../2-prerequiste/">
           <b> 2. </b> Preparation 
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.1-createcloud9workspace/" title="Create a new Cloud9 IDE" class="dd-item 
        
        
        
        ">
      <a href="../../2-prerequiste/2.1-createcloud9workspace/">
           <b> 2.1 </b> Create a new Cloud9 IDE
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.2-repodisk/" title="Increase free disk of Cloud9" class="dd-item 
        
        
        
        ">
      <a href="../../2-prerequiste/2.2-repodisk/">
           <b> 2.2 </b> Increase free disk of Cloud9
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.3-installtool/" title="Install necessary tools" class="dd-item 
        
        
        
        ">
      <a href="../../2-prerequiste/2.3-installtool/">
           <b> 2.3 </b> Install necessary tools
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-prerequiste/2.4-cloudwatch/" title="Setup CloudWatch log role ARN for API Gateway" class="dd-item 
        
        
        
        ">
      <a href="../../2-prerequiste/2.4-cloudwatch/">
           <b> 2.4 </b> Setup CloudWatch log role ARN for API Gateway
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-serverless/" title="Introducing a basic serverless web application" class="dd-item 
        
        
        
        ">
      <a href="../../3-serverless/">
           <b> 3. </b> Introducing a basic serverless web application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-serverless/3.1-deploy/" title="Deploy the application" class="dd-item 
        
        
        
        ">
      <a href="../../3-serverless/3.1-deploy/">
           <b> 3.1. </b> Deploy the application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-serverless/3.2-adddata/" title="Adding data and exploring the" class="dd-item 
        
        
        
        ">
      <a href="../../3-serverless/3.2-adddata/">
           <b> 3.2. </b> Adding data and exploring the
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-serverless/3.3-reviewcode/" title="Review the code" class="dd-item 
        
        
        
        ">
      <a href="../../3-serverless/3.3-reviewcode/">
           <b> 3.3. </b> Review the code
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-saas/" title="Introducing SaaS shared services" class="dd-item 
        parent
        
        
        ">
      <a href="../../4-saas/">
           <b> 4. </b> Introducing SaaS shared services
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/4-saas/4.1-ini/" title="Initialize the project" class="dd-item 
        
        
        
        ">
      <a href="../../4-saas/4.1-ini/">
           <b> 4.1. </b> Initialize the project
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-saas/4.2-misscode/" title="Adding the missing code" class="dd-item 
        
        active
        
        ">
      <a href="../../4-saas/4.2-misscode/">
           <b> 4.2. </b> Adding the missing code
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-saas/4.3-deploy/" title="Deploying the changes" class="dd-item 
        
        
        
        ">
      <a href="../../4-saas/4.3-deploy/">
           <b> 4.3. </b> Deploying the changes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-onboarding/" title="Onboarding application" class="dd-item 
        
        
        
        ">
      <a href="../../5-onboarding/">
           <b> 5. </b> Onboarding application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/5-onboarding/5.1-onboardingadmin/" title="Onboarding SaaS admin application" class="dd-item 
        
        
        
        ">
      <a href="../../5-onboarding/5.1-onboardingadmin/">
           <b> 5.1. </b> Onboarding SaaS admin application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-onboarding/5.2-landing/" title="Onboarding the Sign-up application" class="dd-item 
        
        
        
        ">
      <a href="../../5-onboarding/5.2-landing/">
           <b> 5.2. </b> Onboarding the Sign-up application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-onboarding/5.3-data/" title="Reviewing the underlying data stores" class="dd-item 
        
        
        
        ">
      <a href="../../5-onboarding/5.3-data/">
           <b> 5.3. </b> Reviewing the underlying data stores
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-sum/" title="Summary" class="dd-item 
        
        
        
        ">
      <a href="../../6-sum/">
           <b> 6. </b> Summary
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-terminate/" title="Cleanup" class="dd-item 
        
        
        
        ">
      <a href="../../7-terminate/">
           <b> 7. </b> Cleanup
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/4-saas/4.2-misscode/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/4-saas/4.2-misscode/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>17-08-2023</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
                <a href="#"  style="color:orange">Hoàng Kha</a> <br>
                <a href="https://www.linkedin.com/in/l%C3%AA-ngh%C4%A9a-43075a197/"  style="color:orange">Minh nghĩa</a>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../../'>AWS Serverless SaaS Workshop</a> > <a href='../../4-saas/'>Introducing SaaS shared services</a> > Adding the missing code
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Adding the missing code
            </h1>
          

        



	<h4 id="review-the-code-in-the-ide">Review the code in the IDE</h4>
<p>Before we start modifying the application and adding/changing code, let’s look at how the code is organized in the Cloud9 IDE.</p>
<ol>
<li>In your IDE, open folder <strong>Lab2,</strong> we will see foler <strong>server.</strong> There is new folder <strong>TenantManagementService.</strong> This folder contains code of our shared services it represents for various microservices used to support the horizontal requirements of the serverless SaaS solution. It includes registration service, tenant management service, and user management service. With each file on this list written in Python with Lambda functions as part of microservices.</li>
</ol>
<p><img src="../../images/4.2-code/4.2-1.png" alt="VPC"></p>
<ol start="2">
<li>In the <strong>Lab2/server folder,</strong> we also see a <strong>Resource</strong> folder containing the file <strong>shared_service_authorizer.py.</strong> This file will include the code of the lambda authorizer, which is used for API Gateway to authenticate the SaaS admin application.</li>
</ol>
<p><img src="../../images/4.2-code/4.2-2.png" alt="VPC"></p>
<ol start="3">
<li>Finally, look at the <strong>nested_templates</strong> subfolder and see how we break down our application from the template file into smaller files that are easy to manage and maintain. And now the <strong>template.yaml</strong> file uses these files to deploy infrastructure. It allows us to break down the infrastructure code into smaller pieces that are easier to manage.</li>
</ol>
<p><img src="../../images/4.2-code/4.2-3.png" alt="VPC"></p>
<p>Now we are going to finalize the code for our application.</p>
<h4 id="tenant-management-service">Tenant Management Service</h4>
<p>Let&rsquo;s go to the <code>Lab2/server/TenantManagementService</code> folder and open the <strong>tenant-management.py</strong> file in your IDE and find the <strong>get_tenant.</strong> method this lambda function is used by the GET method of API Gateway <strong>/tenant</strong> to get all tenant details. This method has not been executed yet, we execute this method to retrieve data from DynamoDB table and return the result to UI. You can use the code below and add the <strong>get_tenant</strong> function we found to accomplish.</p>
<pre tabindex="0"><code>def get_tenant(event, context):
    tenant_id = event[&#39;pathParameters&#39;][&#39;tenantid&#39;]
    logger.info(&#34;Request received to get tenant details&#34;)

    tenant_details = table_tenant_details.get_item(
        Key={
            &#39;tenantId&#39;: tenant_id,
        },
        AttributesToGet=[
            &#39;tenantName&#39;,
            &#39;tenantAddress&#39;,
            &#39;tenantEmail&#39;,
            &#39;tenantPhone&#39;
        ]
    )
    item = tenant_details[&#39;Item&#39;]
    tenant_info = TenantInfo(item[&#39;tenantName&#39;], item[&#39;tenantAddress&#39;],item[&#39;tenantEmail&#39;], item[&#39;tenantPhone&#39;])
    logger.info(tenant_info)

    logger.info(&#34;Request completed to get tenant details&#34;)
    return utils.create_success_response(tenant_info.__dict__)
</code></pre><p>You will see we used <strong>tenant_id</strong> to retrieve data from the <strong>tenant_details</strong> table and return the result. You can see we used <strong>AttributesToGet</strong> to specify the attributes we want to get from the table. You can add other attributes if needed.</p>
<h4 id="user-management-service">User Management Service</h4>
<p>Similar to the above, we will do the same with the <strong>create_user</strong> method in the <strong>user-management.py</strong> file in the <code>Lab2/server/TenantManagementService</code> directory.</p>
<pre tabindex="0"><code>def create_user(event, context):
    user_details = json.loads(event[&#39;body&#39;])

    logger.info(&#34;Request received to create new user&#34;)
    logger.info(event)

    tenant_id = user_details[&#39;tenantId&#39;]

    response = client.admin_create_user(
        Username=user_details[&#39;userName&#39;],
        UserPoolId=user_pool_id,
        ForceAliasCreation=True,
        UserAttributes=[
            {
                &#39;Name&#39;: &#39;email&#39;,
                &#39;Value&#39;: user_details[&#39;userEmail&#39;]
            },
            {
                &#39;Name&#39;: &#39;custom:userRole&#39;,
                &#39;Value&#39;: user_details[&#39;userRole&#39;]
            },
            {
                &#39;Name&#39;: &#39;custom:tenantId&#39;,
                &#39;Value&#39;: tenant_id
            }
        ]
    )

    logger.info(response)
    user_mgmt = UserManagement()
    user_mgmt.add_user_to_group(user_pool_id, user_details[&#39;userName&#39;], tenant_id)
    response_mapping = user_mgmt.create_user_tenant_mapping(user_details[&#39;userName&#39;], tenant_id)

    logger.info(&#34;Request completed to create new user &#34;)
    return utils.create_success_response(&#34;New user created&#34;)
</code></pre><p>You&rsquo;ll see we used <strong>user_details</strong> to get the user&rsquo;s information from the request body and used <strong>tenant_id</strong> to add the user to the tenant&rsquo;s group. You can add other attributes if needed. Notice how tenantId and userRole are stored as custom attributes.</p>
<h4 id="registration-service">Registration Service</h4>
<p>In service Registration is the service that coordinates the onboarding flow. The Registration service is invoked through the API Gateway as a public endpoint. This is by design because new tenants cannot be authenticated. However, the endpoints used to create tenant admins and tenants are protected by API Gateway resource policies capabilitty. These endpoints can only be called from the Tenant Registration service.</p>
<p>Currently, the <strong>register_tenant</strong> method in the <strong>tenant_registration.py</strong> file in the <code>Lab2/server/TenantManagementService</code> directory is empty. Find this method and add the code below.</p>
<pre tabindex="0"><code>def register_tenant(event, context):
    try:
        tenant_id = uuid.uuid1().hex
        tenant_details = json.loads(event[&#39;body&#39;])

        tenant_details[&#39;tenantId&#39;] = tenant_id

        logger.info(tenant_details)

        stage_name = event[&#39;requestContext&#39;][&#39;stage&#39;]
        host = event[&#39;headers&#39;][&#39;Host&#39;]
        auth = utils.get_auth(host, region)
        headers = utils.get_headers(event)
        create_user_response = __create_tenant_admin_user(tenant_details, headers, auth, host, stage_name)

        logger.info (create_user_response)
        tenant_details[&#39;tenantAdminUserName&#39;] = create_user_response[&#39;message&#39;][&#39;tenantAdminUserName&#39;]

        create_tenant_response = __create_tenant(tenant_details, headers, auth, host, stage_name)
        logger.info (create_tenant_response)

    except Exception as e:
        logger.error(&#39;Error registering a new tenant&#39;)
        raise Exception(&#39;Error registering a new tenant&#39;, e)
    else:
        return utils.create_success_response(&#34;You have been registered in our system&#34;)
</code></pre><p>You will see this code creates a <strong>tenant_id</strong> and adds <strong>tenant_details</strong>. Then it will call <strong>__create_tenant_admin_user</strong> and <strong>__create_tenant</strong> methods to create tenant admin and tenant. You can add other attributes if needed.</p>

<div class="notices warning" ><p>Remember to save the edited files with the keyboard shortcut <strong>Ctrl+S</strong> or <strong>Cmd+S</strong>.</p>
</div>






<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../4-saas/4.1-ini/" title="Initialize the project"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../4-saas/4.3-deploy/" title="Deploying the changes" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1692263736"></script>
    <script src="../../js/perfect-scrollbar.min.js?1692263736"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1692263736"></script>
    <script src="../../js/jquery.sticky.js?1692263736"></script>
    <script src="../../js/featherlight.min.js?1692263736"></script>
    <script src="../../js/highlight.pack.js?1692263736"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js?1692263736"></script>
    <script src="../../js/learn.js?1692263736"></script>
    <script src="../../js/hugo-learn.js?1692263736"></script>

    <link href="../../mermaid/mermaid.css?1692263736" rel="stylesheet" />
    <script src="../../mermaid/mermaid.js?1692263736"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
